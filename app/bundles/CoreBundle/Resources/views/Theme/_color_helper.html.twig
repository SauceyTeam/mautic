{% set _primary_color = configGetParameter('primary_brand_color')|default('000000') %}

{# Manual hex to decimal conversion for more reliability #}
{% set hexMap = {'0':0, '1':1, '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, 'a':10, 'b':11, 'c':12, 'd':13, 'e':14, 'f':15, 'A':10, 'B':11, 'C':12, 'D':13, 'E':14, 'F':15} %}

{% set r = (hexMap[_primary_color|slice(0, 1)] * 16 + hexMap[_primary_color|slice(1, 1)]) %}
{% set g = (hexMap[_primary_color|slice(2, 1)] * 16 + hexMap[_primary_color|slice(3, 1)]) %}
{% set b = (hexMap[_primary_color|slice(4, 1)] * 16 + hexMap[_primary_color|slice(5, 1)]) %}

{# Calculate perceived brightness #}
{% set brightness = (r * 299 + g * 587 + b * 114) / 1000 %}

{# Choose text color based on brightness threshold #}
{% set _text_on_color = brightness > 125 ? '000000' : 'ffffff' %}

{# Create subtle text color based on main text color #}
{% if _text_on_color == '000000' %}
    {# For dark text on light background, create a dark gray that's not too light #}
    {% set _text_on_color__helper = '6d6d6d' %}
{% else %}
    {# For light text on dark background, create a light gray that's not too dark #}
    {% set _text_on_color__helper = 'b3b3b3' %}
{% endif %}

{{ save('_color_helper') }}